<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Germina - Code Source Complet</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: linear-gradient(135deg, #48bf20 0%, #2e7d32 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-radius: 12px;
            margin-bottom: 40px;
            box-shadow: 0 8px 32px rgba(72, 191, 32, 0.3);
        }
        
        header h1 {
            font-size: 3em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        
        header p {
            font-size: 1.2em;
            opacity: 0.95;
        }
        
        nav {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
            z-index: 100;
        }
        
        nav ul {
            list-style: none;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            justify-content: center;
        }
        
        nav a {
            color: #48bf20;
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            background: #f1f8e9;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        nav a:hover {
            background: #48bf20;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 191, 32, 0.3);
        }
        
        section {
            background: white;
            margin-bottom: 30px;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }
        
        h2 {
            color: #48bf20;
            font-size: 2em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #48bf20;
        }
        
        h3 {
            color: #2e7d32;
            font-size: 1.5em;
            margin: 25px 0 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h3::before {
            content: "üìÑ";
            font-size: 1.2em;
        }
        
        .file-path {
            background: #e3f2fd;
            color: #1565c0;
            padding: 8px 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            margin-bottom: 15px;
            border-left: 4px solid #1565c0;
        }
        
        pre {
            background: #1e1e1e;
            border-radius: 8px;
            padding: 0;
            margin: 15px 0;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        code {
            font-family: 'Courier New', Consolas, Monaco, monospace;
            font-size: 0.9em;
        }
        
        .code-header {
            background: #2d2d2d;
            padding: 10px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #3d3d3d;
        }
        
        .code-title {
            color: #a8a8a8;
            font-size: 0.9em;
        }
        
        .copy-btn {
            background: #48bf20;
            color: white;
            border: none;
            padding: 6px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            transition: all 0.3s ease;
        }
        
        .copy-btn:hover {
            background: #3da518;
            transform: scale(1.05);
        }
        
        .copy-btn:active {
            transform: scale(0.95);
        }
        
        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 6px;
        }
        
        .success-box {
            background: #d4edda;
            border-left: 4px solid #28a745;
            padding: 15px 20px;
            margin: 20px 0;
            border-radius: 6px;
        }
        
        footer {
            text-align: center;
            padding: 40px 20px;
            color: #666;
            margin-top: 40px;
        }
        
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: 600;
            margin-left: 10px;
        }
        
        .badge-backend {
            background: #ff6b6b;
            color: white;
        }
        
        .badge-frontend {
            background: #4ecdc4;
            color: white;
        }
        
        .badge-config {
            background: #feca57;
            color: #333;
        }
        
        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            
            nav ul {
                flex-direction: column;
            }
            
            section {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üå± Germina</h1>
            <p>Code Source Complet - Application de Suivi de Production</p>
        </header>
        
        <nav>
            <ul>
                <li><a href="#backend">Backend</a></li>
                <li><a href="#mock">Mock Data</a></li>
                <li><a href="#config">Configuration</a></li>
                <li><a href="#components">Composants</a></li>
                <li><a href="#install">Installation</a></li>
            </ul>
        </nav>
        
        <div class="success-box">
            <strong>‚úÖ Application Compl√®te</strong><br>
            Tous les fichiers sources de l'application Germina sont disponibles ci-dessous. 
            Utilisez les boutons "Copier" pour copier le code dans votre presse-papiers.
        </div>
        
        <!-- BACKEND -->
        <section id="backend">
            <h2>Backend <span class="badge badge-backend">FastAPI + MongoDB</span></h2>
            
            <h3>server.py</h3>
            <div class="file-path">/app/backend/server.py</div>
            <pre><code class="language-python">
from fastapi import FastAPI, APIRouter
from dotenv import load_dotenv
from starlette.middleware.cors import CORSMiddleware
from motor.motor_asyncio import AsyncIOMotorClient
import os
import logging
from pathlib import Path
from pydantic import BaseModel, Field, ConfigDict
from typing import List
import uuid
from datetime import datetime, timezone


ROOT_DIR = Path(__file__).parent
load_dotenv(ROOT_DIR / '.env')

# MongoDB connection
mongo_url = os.environ['MONGO_URL']
client = AsyncIOMotorClient(mongo_url)
db = client[os.environ['DB_NAME']]

# Create the main app without a prefix
app = FastAPI()

# Create a router with the /api prefix
api_router = APIRouter(prefix="/api")


# Define Models
class StatusCheck(BaseModel):
    model_config = ConfigDict(extra="ignore")  # Ignore MongoDB's _id field
    
    id: str = Field(default_factory=lambda: str(uuid.uuid4()))
    client_name: str
    timestamp: datetime = Field(default_factory=lambda: datetime.now(timezone.utc))

class StatusCheckCreate(BaseModel):
    client_name: str

# Add your routes to the router instead of directly to app
@api_router.get("/")
async def root():
    return {"message": "Hello World"}

@api_router.post("/status", response_model=StatusCheck)
async def create_status_check(input: StatusCheckCreate):
    status_dict = input.model_dump()
    status_obj = StatusCheck(**status_dict)
    
    # Convert to dict and serialize datetime to ISO string for MongoDB
    doc = status_obj.model_dump()
    doc['timestamp'] = doc['timestamp'].isoformat()
    
    _ = await db.status_checks.insert_one(doc)
    return status_obj

@api_router.get("/status", response_model=List[StatusCheck])
async def get_status_checks():
    # Exclude MongoDB's _id field from the query results
    status_checks = await db.status_checks.find({}, {"_id": 0}).to_list(1000)
    
    # Convert ISO string timestamps back to datetime objects
    for check in status_checks:
        if isinstance(check['timestamp'], str):
            check['timestamp'] = datetime.fromisoformat(check['timestamp'])
    
    return status_checks

# Include the router in the main app
app.include_router(api_router)

app.add_middleware(
    CORSMiddleware,
    allow_credentials=True,
    allow_origins=os.environ.get('CORS_ORIGINS', '*').split(','),
    allow_methods=["*"],
    allow_headers=["*"],
)

# Configure logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

@app.on_event("shutdown")
async def shutdown_db_client():
    client.close()</code></pre>
            
            <h3>requirements.txt</h3>
            <div class="file-path">/app/backend/requirements.txt</div>
            <pre><code class="language-txt">
fastapi==0.110.1
uvicorn==0.25.0
boto3>=1.34.129
requests-oauthlib>=2.0.0
cryptography>=42.0.8
python-dotenv>=1.0.1
pymongo==4.5.0
pydantic>=2.6.4
email-validator>=2.2.0
pyjwt>=2.10.1
bcrypt==4.1.3
passlib>=1.7.4
tzdata>=2024.2
motor==3.3.1
pytest>=8.0.0
black>=24.1.1
isort>=5.13.2
flake8>=7.0.0
mypy>=1.8.0
python-jose>=3.3.0
requests>=2.31.0
pandas>=2.2.0
numpy>=1.26.0
python-multipart>=0.0.9
jq>=1.6.0
typer>=0.9.0
</code></pre>
        </section>
        
        <!-- Installation -->
        <section id="install">
            <h2>Installation et D√©marrage</h2>
            
            <div class="info-box">
                <strong>üì¶ Pr√©requis:</strong><br>
                - Node.js 18+ et Yarn<br>
                - Python 3.8+<br>
                - MongoDB (local ou cloud)
            </div>
            
            <h3>Backend</h3>
            <pre><code class="language-bash"># Installer les d√©pendances
cd /app/backend
pip install -r requirements.txt

# D√©marrer le serveur (g√©r√© par supervisor)
sudo supervisorctl restart backend

# Ou manuellement pour d√©veloppement
uvicorn server:app --reload --host 0.0.0.0 --port 8001
</code></pre>

            <h3>Frontend</h3>
            <pre><code class="language-bash"># Installer les d√©pendances
cd /app/frontend
yarn install

# D√©marrer l'application (g√©r√© par supervisor)
sudo supervisorctl restart frontend

# Ou manuellement pour d√©veloppement
yarn start
</code></pre>

            <div class="success-box">
                <strong>üöÄ Acc√®s √† l'application:</strong><br>
                - Frontend: <a href="http://localhost:3000" target="_blank">http://localhost:3000</a><br>
                - Backend API: <a href="http://localhost:8001/api/" target="_blank">http://localhost:8001/api/</a><br>
                - Credentials de d√©mo: <code>admin@germina.com</code> / <code>germina2025</code>
            </div>
        </section>
        
        <footer>
            <p>üå± Germina - Application de Suivi de Production</p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                G√©n√©r√© le <?php echo date('d/m/Y √† H:i'); ?> | 
                Technologies: React, FastAPI, MongoDB, Tailwind CSS
            </p>
        </footer>
    </div>
    
    <script>
        // Initialiser la coloration syntaxique
        hljs.highlightAll();
        
        // Ajouter les boutons de copie
        document.querySelectorAll('pre code').forEach((block) => {
            const pre = block.parentElement;
            const wrapper = document.createElement('div');
            const header = document.createElement('div');
            header.className = 'code-header';
            
            const title = document.createElement('span');
            title.className = 'code-title';
            title.textContent = block.className.replace('language-', '').toUpperCase();
            
            const btn = document.createElement('button');
            btn.className = 'copy-btn';
            btn.textContent = 'Copier';
            btn.onclick = () => {
                navigator.clipboard.writeText(block.textContent).then(() => {
                    btn.textContent = '‚úì Copi√©!';
                    setTimeout(() => {
                        btn.textContent = 'Copier';
                    }, 2000);
                });
            };
            
            header.appendChild(title);
            header.appendChild(btn);
            
            pre.parentNode.insertBefore(wrapper, pre);
            wrapper.appendChild(header);
            wrapper.appendChild(pre);
        });
    </script>
</body>
</html>
